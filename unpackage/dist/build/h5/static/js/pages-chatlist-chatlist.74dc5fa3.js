(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-chatlist-chatlist"],{"06c5":function(t,e,a){"use strict";a("a630"),a("fb6a"),a("d3b7"),a("25f0"),a("3ca3"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var i=n(a("6b75"));function n(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(t){if("string"===typeof t)return(0,i.default)(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?(0,i.default)(t,e):void 0}}},"09f0":function(t,e,a){"use strict";function i(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var a=[],i=!0,n=!1,o=void 0;try{for(var s,r=t[Symbol.iterator]();!(i=(s=r.next()).done);i=!0)if(a.push(s.value),e&&a.length===e)break}catch(u){n=!0,o=u}finally{try{i||null==r["return"]||r["return"]()}finally{if(n)throw o}}return a}}a("a4d3"),a("e01a"),a("d28b"),a("d3b7"),a("3ca3"),a("ddb0"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=i},"0d21":function(t,e,a){"use strict";function i(t){if(Array.isArray(t))return t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i},"1dd9":function(t,e,a){"use strict";a.r(e);var i=a("b3d0"),n=a.n(i);for(var o in i)"default"!==o&&function(t){a.d(e,t,(function(){return i[t]}))}(o);e["default"]=n.a},"201f":function(t,e,a){"use strict";(function(t){var i=a("4ea4");a("d81d"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(a("a9bd"));function o(t,e,a){this.uuid=t,this.name=e,this.avatar=a}function s(t,e,a){this.uuid=t,this.name=e,this.avatar=a}function r(t,e){this.currentUser=null,this.groups={},this.GoEasy=e,this.goEasy=t,this.privateMessages={},this.groupMessages={},this.onNewPrivateMessageReceive=function(t,e){},this.onNewGroupMessageReceive=function(t,e){}}r.prototype.getGroupMembers=function(t){var e=n.default.findGroupMembers(t),a={};return e.map((function(t){a[t.uuid]=t})),a},r.prototype.findGroupById=function(t){var e=n.default.findGroupById(t);return new s(e.uuid,e.name,e.avatar)},r.prototype.findFriendById=function(e){t("log","t1"," at lib/imservice.js:62");var a=n.default.findUserById(e);return t("log","t1"+a.uuid,a.name,a.avatar," at lib/imservice.js:64"),new o(a.uuid,a.name,a.avatar)},r.prototype.getGroupMessages=function(t){return this.groupMessages[t]||(this.groupMessages[t]=[]),this.groupMessages[t]},r.prototype.getPrivateMessages=function(t){return this.privateMessages[t]||(this.privateMessages[t]=[]),this.privateMessages[t]},r.prototype.connect=function(e){this.currentUser=e;var a={name:this.currentUser.name,avatar:this.currentUser.avatar};this.initialListeners(),this.goEasy.connect({id:this.currentUser.uuid,data:a,onSuccess:function(){t("log","GoEasy connect successfully."," at lib/imservice.js:96")},onFailed:function(e){t("log","Failed to connect GoEasy, code:"+e.code+",error:"+e.content," at lib/imservice.js:100"),uni.request({url:"https://koudai.seekerapp.xyz/Market/ChatError"})},onProgress:function(e){t("log","GoEasy is connecting",e," at lib/imservice.js:106")}}),this.subscribeGroupMessage(e)},r.prototype.subscribeGroupMessage=function(){var e=n.default.findGroups(this.currentUser),a=e.map((function(t){return t.uuid}));this.goEasy.im.subscribeGroup({groupIds:a,onSuccess:function(){t("log","订阅群消息成功"," at lib/imservice.js:119")},onFailed:function(e){t("log","订阅群消息失败"," at lib/imservice.js:123")}})},r.prototype.initialListeners=function(){var t=this;this.goEasy.im.on(this.GoEasy.IM_EVENT.PRIVATE_MESSAGE_RECEIVED,(function(e){var a;a=t.currentUser.uuid===e.senderId?e.receiverId:e.senderId;var i=t.getPrivateMessages(a);i.push(e),t.onNewPrivateMessageReceive(a,e)})),this.goEasy.im.on(this.GoEasy.IM_EVENT.GROUP_MESSAGE_RECEIVED,(function(e){var a=e.groupId,i=t.getGroupMessages(a);i.push(e),t.onNewGroupMessageReceive(a,e)}))};var u=r;e.default=u}).call(this,a("0de9")["log"])},"2af7":function(t,e,a){var i=a("24fb"),n=a("1de5"),o=a("8c02");e=i(!1);var s=n(o);e.push([t.i,"uni-page-body[data-v-75131f96]{height:100%;background-color:#f5f5f5}.conversations[data-v-75131f96]{width:%?750?%;overflow-x:hidden;display:flex;flex-direction:column;box-sizing:border-box;height:100%}.conversations .scroll-item[data-v-75131f96]{height:%?152?%;display:flex;align-items:center;padding-left:%?32?%}.ontop[data-v-75131f96]{height:%?152?%;display:flex;align-items:center;padding-left:%?32?%;background-color:#eee}.notontop[data-v-75131f96]{height:%?152?%;display:flex;align-items:center;padding-left:%?32?%}.conversations .scroll-item .head-icon[data-v-75131f96]{width:%?100?%;height:%?100?%;margin-right:%?28?%}.conversations .scroll-item_info[data-v-75131f96]{height:%?151?%;width:%?590?%;padding-right:%?32?%;box-sizing:border-box;border-bottom:1px solid #efefef}.conversations .scroll-item_info .item-info-top[data-v-75131f96]{padding-top:%?20?%;height:%?60?%;line-height:%?60?%;display:flex;align-items:center;justify-content:space-between}.conversations .item-info-top_name[data-v-75131f96]{font-size:%?34?%;color:#262628}.conversations .item-info-top_time[data-v-75131f96]{font-size:%?26?%;color:hsla(0,0%,70.2%,.8);font-family:Source Han Sans CN}.conversations .item-info-bottom[data-v-75131f96]{height:%?40?%;line-height:%?40?%;overflow:hidden}.conversations .item-info-bottom-item[data-v-75131f96]{display:flex;justify-content:space-between}.item-info-bottom .item-info-top_content[data-v-75131f96]{font-size:%?30?%;color:#b3b3b3;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.item-info-bottom .item-info-bottom_action[data-v-75131f96]{width:%?50?%;height:%?50?%;font-size:%?20?%;background:url("+s+") no-repeat 50%;background-size:%?28?% %?30?%}.no-conversation[data-v-75131f96]{width:100%;text-align:center;height:%?80?%;line-height:%?80?%;font-size:%?28?%;color:#9d9d9d}.item-head[data-v-75131f96]{position:relative}.item-head .item-head_unread[data-v-75131f96]{padding:%?6?%;background-color:#ee593c;color:#fff;font-size:%?24?%;line-height:%?28?%;border-radius:%?24?%;min-width:%?24?%;min-height:%?24?%;text-align:center;position:absolute;top:0;right:%?15?%}.action-container[data-v-75131f96]{width:100%;height:100%;position:absolute;top:0;left:0;display:flex;justify-content:center;align-items:center}.action-container .layer[data-v-75131f96]{position:absolute;top:0;left:0;background:rgba(51,51,51,.5);width:100%;height:100%;z-index:99}.action-box[data-v-75131f96]{width:%?400?%;height:%?240?%;background:#fff;position:relative;z-index:100;border-radius:%?20?%;overflow:hidden}.action-item[data-v-75131f96]{text-align:center;line-height:%?120?%;font-size:%?34?%;color:#262628;border-bottom:1px solid #efefef}body.?%PAGE?%[data-v-75131f96]{background-color:#f5f5f5}",""]),t.exports=e},3835:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=u;var i=r(a("0d21")),n=r(a("09f0")),o=r(a("06c5")),s=r(a("3d8c"));function r(t){return t&&t.__esModule?t:{default:t}}function u(t,e){return(0,i.default)(t)||(0,n.default)(t,e)||(0,o.default)(t,e)||(0,s.default)()}},"3d8c":function(t,e,a){"use strict";function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i},5949:function(t,e,a){"use strict";var i;a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return o})),a.d(e,"a",(function(){return i}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-scroll-view",{staticClass:"conversations",attrs:{"scroll-y":"true"}},[0!=t.conversations.length?a("v-uni-view",t._l(t.conversations,(function(e,i){return a("v-uni-view",{key:i,class:e.top?"scroll-item ontop":"scroll-item",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.navigateToChat(e)}}},[a("v-uni-view",{staticClass:"item-head"},[a("v-uni-image",{staticClass:"head-icon",attrs:{src:e.data.avatar}}),e.unread?a("v-uni-view",{staticClass:"item-head_unread"},[t._v(t._s(e.unread))]):t._e()],1),a("v-uni-view",{staticClass:"scroll-item_info"},[a("v-uni-view",{staticClass:"item-info-top"},[a("v-uni-text",{staticClass:"item-info-top_name"},[t._v(t._s(e.data.name))]),a("v-uni-view",{staticClass:"item-info-top_time"},[t._v(t._s(t.formatDate(e.lastMessage.timestamp)))])],1),a("v-uni-view",{staticClass:"item-info-bottom"},[a("v-uni-view",{staticClass:"item-info-bottom-item"},["text"==e.lastMessage.type?a("v-uni-view",{staticClass:"item-info-top_content"},[t._v(t._s(e.lastMessage.payload.text))]):"video"==e.lastMessage.type?a("v-uni-view",{staticClass:"item-info-top_content"},[t._v("[视频消息]")]):"audio"==e.lastMessage.type?a("v-uni-view",{staticClass:"item-info-top_content"},[t._v("[语音消息]")]):"image"==e.lastMessage.type?a("v-uni-view",{staticClass:"item-info-top_content"},[t._v("[图片消息]")]):"file"==e.lastMessage.type?a("v-uni-view",{staticClass:"item-info-top_content"},[t._v("[文件消息]")]):"order"==e.lastMessage.type?a("v-uni-view",{staticClass:"item-info-top_content"},[t._v("[自定义消息:订单]")]):a("v-uni-view",{staticClass:"item-info-top_content"},[t._v("[[未识别内容]]")]),a("v-uni-view",{staticClass:"item-info-bottom_action",on:{click:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.showAction(e)}}})],1)],1)],1)],1)})),1):a("v-uni-view",{staticClass:"no-conversation"},[t._v("当前没有会话")]),t.action.show?a("v-uni-view",{staticClass:"action-container"},[a("v-uni-view",{staticClass:"layer",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.action.show=!1}}}),a("v-uni-view",{staticClass:"action-box"},[a("v-uni-view",{staticClass:"action-item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.topConversation.apply(void 0,arguments)}}},[t._v(t._s(t.action.conversation.top?"取消置顶":"置顶聊天"))]),a("v-uni-view",{staticClass:"action-item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.removeConversation.apply(void 0,arguments)}}},[t._v("删除聊天")])],1)],1):t._e()],1)},o=[]},"6b75":function(t,e,a){"use strict";function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i},"8c02":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAABgSURBVHgB7Y6xDYAwDASDvQAjsBmNF2CDsAEDuGEzRsgCtnikBCEqQpucFOlPl8IhdBpmUNXZzDbsxMxRRPYSaxpBImTEm3K4qWmUpZBeF39u5O4LxnEJ9vr8+bd1muMEOUNL5++YjiMAAAAASUVORK5CYII="},a517:function(t,e,a){"use strict";var i=a("e4e1"),n=a.n(i);n.a},a9bd:function(t,e,a){"use strict";(function(t){var i=a("4ea4");a("4de4"),a("7db0"),a("d81d"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(a("3835")),o=[{uuid:"08c0a6ec-a42b",name:"Mattie",password:"123",avatar:"/static/images/Avatar-1.png"},{uuid:"3bb179af-bcc5",name:"Wallace",password:"123",avatar:"/static/images/Avatar-2.png"},{uuid:"fdee46b0-4b01-4590-bdba-6586d7617f95",name:"Tracy",password:"123",avatar:"/static/images/Avatar-3.png"},{uuid:"33c3693b-dbb0-4bc9-99c6-fa77b9eb763f",name:"Juanita",password:"123",avatar:"/static/images/Avatar-4.png"}],s=[{uuid:"group-a42b-47b2-bb1e-15e0f5f9a19a",name:"小程序交流群",avatar:"/static/images/wx.png",userList:["08c0a6ec-a42b-47b2-bb1e-15e0f5f9a19a","3bb179af-bcc5-4fe0-9dac-c05688484649","fdee46b0-4b01-4590-bdba-6586d7617f95","33c3693b-dbb0-4bc9-99c6-fa77b9eb763f"]},{uuid:"group-4b01-4590-bdba-6586d7617f95",name:"UniApp交流群",avatar:"/static/images/uniapp.png",userList:["08c0a6ec-a42b-47b2-bb1e-15e0f5f9a19a","fdee46b0-4b01-4590-bdba-6586d7617f95","33c3693b-dbb0-4bc9-99c6-fa77b9eb763f"]},{uuid:"group-dbb0-4bc9-99c6-fa77b9eb763f",name:"GoEasy交流群",avatar:"/static/images/goeasy.jpeg",userList:["08c0a6ec-a42b-47b2-bb1e-15e0f5f9a19a","3bb179af-bcc5-4fe0-9dac-c05688484649"]}];function r(){}r.prototype.findFriends=function(t){var e=o.filter((function(e){return e.uuid!=t.uuid}));return e},r.prototype.findGroups=function(t){var e=s.filter((function(e){return e.userList.find((function(e){return e==t.uuid}))}));return e},r.prototype.findUser=function(t,e){var a=o.find((function(a){return a.name===t&&a.password===e}));return a?{uuid:a.uuid,avatar:a.avatar,name:a.name}:a},r.prototype.findGroupById=function(t){var e=s.find((function(e){return e.uuid==t}));return e},r.prototype.findUserById=function(e){var a=o.find((function(t){return t.uuid==e})),i=uni.request({method:"GET",url:"https://shixiaozhuback.nanju.work:11731/user/getuserbyid",data:{openID:e},success:function(e){return t("log",e.data," at lib/restapi.js:96"),a.uuid=e.data.uuid,a.name=e.data.name,a.avatar=e.data.avater,a}}),s=(0,n.default)(i,2);s[0],s[1];return t("log","..."," at lib/restapi.js:103"),a},r.prototype.findGroupMembers=function(t){var e=[],a=s.find((function(e){return e.uuid==t}));return o.map((function(t){a.userList.find((function(e){return e==t.uuid}))&&e.push(t)})),e};var u=new r;e.default=u}).call(this,a("0de9")["log"])},b3d0:function(t,e,a){"use strict";(function(t){var i=a("4ea4");a("d3b7"),a("25f0"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(a("201f")),o={name:"contacts",data:function(){return{unreadTotal:0,conversations:[],action:{conversation:null,show:!1}}},onShow:function(){var e=uni.getStorageSync("currentUser");if(e){"disconnected"===this.goEasy.getConnectionStatus()&&(getApp().globalData.imService=new n.default(this.goEasy,this.GoEasy),getApp().globalData.imService.connect(e)),uni.showLoading();var a=this;this.goEasy.im.on(this.GoEasy.IM_EVENT.CONVERSATIONS_UPDATED,(function(t){a.renderConversations(t)})),this.goEasy.im.latestConversations({onSuccess:function(t){var e=t.content;a.renderConversations(e),uni.hideLoading()},onFailed:function(e){uni.hideLoading(),t("log","失败获取最新会话列表, code:"+e.code+" content:"+e.content," at pages/chatlist/chatlist.vue:84")}})}else uni.switchTab({url:"/pages/me/me"})},onTabItemTap:function(){var e=uni.getStorageSync("currentUser");if(e){"disconnected"===this.goEasy.getConnectionStatus()&&(getApp().globalData.imService=new n.default(this.goEasy,this.GoEasy),getApp().globalData.imService.connect(e)),uni.showLoading();var a=this;this.goEasy.im.on(this.GoEasy.IM_EVENT.CONVERSATIONS_UPDATED,(function(t){a.renderConversations(t)})),this.goEasy.im.latestConversations({onSuccess:function(e){var i=e.content;a.renderConversations(i),uni.hideLoading(),t("log",i," at pages/chatlist/chatlist.vue:113")},onFailed:function(e){uni.hideLoading(),t("log","失败获取最新会话列表, code:"+e.code+" content:"+e.content," at pages/chatlist/chatlist.vue:118")}})}else uni.switchTab({url:"/pages/me/me"})},onReady:function(){var e=uni.getStorageSync("openid");if(void 0!=e.id){getApp().globalData.userID=e.id;var a=this;uni.request({method:"GET",url:"https://shixiaozhuback.nanju.work:11731/login",data:{openID:getApp().globalData.userID,username:getApp().globalData.userName,avater:getApp().globalData.avaterUrl},success:function(e){uni.request({method:"GET",url:"https://shixiaozhuback.nanju.work:11731/getprofile",data:{openid:getApp().globalData.userID},success:function(e){t("log",e," at pages/chatlist/chatlist.vue:147"),getApp().globalData.userName=e.data.name,getApp().globalData.avaterUrl=e.data.avatar,getApp().globalData.sex=e.data.sex,getApp().globalData.pre=e.data.pre,getApp().globalData.tosex=e.data.tosex,getApp().globalData.bematch=e.data.bematch,getApp().globalData.besendmatch=e.data.besendmatch,getApp().globalData.besendmessage=e.data.besendmessage,"disconnected"===a.goEasy.getConnectionStatus()&&(getApp().globalData.imService=new n.default(a.goEasy,a.GoEasy),getApp().globalData.imService.connect({uuid:getApp().globalData.userID,avatar:getApp().globalData.avaterUrl,name:getApp().globalData.userName}),uni.setStorageSync("currentUser",{uuid:getApp().globalData.userID,avatar:getApp().globalData.avaterUrl,name:getApp().globalData.userName})),"[]"===getApp().globalData.pre&&uni.showModal({title:"哇哦！",content:"看来您是首次登录匿名聊天\n先来设置个人资料吧",showCancel:!1,confirmText:"好耶！",success:function(t){t.confirm&&uni.navigateTo({url:"/pages/me/editprofile/editprofile"})}})}})}})}else uni.showModal({title:"等等！",content:"您还没有登录吧？",confirmText:"这就去！",showCancel:!1,success:function(t){t.confirm&&uni.switchTab({url:"/pages/me/me"})}})},methods:{topConversation:function(){uni.showLoading({title:"加载中...",mask:!0});var e=this.action.conversation,a=e.top?"取消置顶失败":"置顶失败";this.action.show=!1,e.type===this.GoEasy.IM_SCENE.PRIVATE?this.goEasy.im.topPrivateConversation({userId:e.userId,top:!e.top,onSuccess:function(){uni.hideLoading()},onFailed:function(e){uni.hideLoading(),uni.showToast({title:a,icon:"none"}),t("log",e," at pages/chatlist/chatlist.vue:232")}}):this.goEasy.im.topGroupConversation({groupId:e.groupId,top:!e.top,onSuccess:function(){uni.hideLoading()},onFailed:function(e){uni.hideLoading(),uni.showToast({title:a,icon:"none"}),t("log",e," at pages/chatlist/chatlist.vue:248")}})},removeConversation:function(){var e=this;uni.showModal({title:"等等！",content:"这一去便是永别\n您想好了吗？",confirmText:"是的！",cancelText:"不对！",success:function(a){if(a.confirm){uni.showLoading({title:"加载中...",mask:!0});var i="删除失败",n=e.action.conversation;e.action.show=!1,n.type===e.GoEasy.IM_SCENE.PRIVATE?e.goEasy.im.removePrivateConversation({userId:n.userId,onSuccess:function(){uni.hideLoading()},onFailed:function(e){uni.hideLoading(),uni.showToast({title:i,icon:"none"}),t("log",e," at pages/chatlist/chatlist.vue:281")}}):e.goEasy.im.removeGroupConversation({groupId:n.groupId,onSuccess:function(){uni.hideLoading()},onFailed:function(e){uni.hideLoading(),uni.showToast({title:i,icon:"none"}),t("log",e," at pages/chatlist/chatlist.vue:296")}})}}})},renderConversations:function(e){this.conversations=e.conversations||[];var a=e.unreadTotal;t("log",this.conversations," at pages/chatlist/chatlist.vue:308"),this.setUnreadAmount(a)},setUnreadAmount:function(t){this.unreadTotal=t,this.unreadTotal>0?uni.setTabBarBadge({index:1,text:this.unreadTotal.toString()}):uni.removeTabBarBadge({index:1})},navigateToChat:function(t){var e="/pages/privateChat/privateChat?to="+t.userId;uni.navigateTo({url:e})},showAction:function(t){this.action.conversation=t,this.action.show=!0}}};e.default=o}).call(this,a("0de9")["log"])},d080:function(t,e,a){"use strict";a.r(e);var i=a("5949"),n=a("1dd9");for(var o in n)"default"!==o&&function(t){a.d(e,t,(function(){return n[t]}))}(o);a("a517");var s,r=a("f0c5"),u=Object(r["a"])(n["default"],i["b"],i["c"],!1,null,"75131f96",null,!1,i["a"],s);e["default"]=u.exports},e4e1:function(t,e,a){var i=a("2af7");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=a("4f06").default;n("5b590c3a",i,!0,{sourceMap:!1,shadowMode:!1})}}]);